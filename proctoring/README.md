# Система защиты от читерства (Proctoring System)

## Критерии оценки (20 баллов)

1. **Эффективность детектирования скопированного кода** - детектирование вставок из буфера обмена
2. **Система верификации оригинальности решения** - проверка на копирование через LLM и эмбеддинги
3. **Анализ браузерных расширений** - детектирование известных расширений
4. **Анализ консолей** - детектирование открытия DevTools

## Архитектура

```
proctoring/
├── client/          # Клиентская часть (JavaScript)
│   ├── clipboard-monitor.js    # Детектирование копирования
│   ├── devtools-detector.js    # Детектирование консоли
│   ├── extension-detector.js   # Детектирование расширений
│   └── proctoring-client.js    # Главный клиент
├── server/          # Серверная часть (Python)
│   ├── api/         # API endpoints
│   ├── analyzers/   # Анализаторы кода и поведения
│   └── database/    # Модели БД
└── shared/          # Общие типы и утилиты
```

## Компоненты

### 1. Детектирование скопированного кода

**Файл:** `client/clipboard-monitor.js`

**Функции:**
- Отслеживание событий `paste`, `copy`, `cut`
- Анализ размера вставленного текста
- Определение структурированного кода (синтаксис, комментарии)
- Отслеживание частоты операций
- Определение паттернов вставки (много кода за раз = подозрительно)

**Метрики:**
- Количество операций paste
- Объем вставленного кода
- Скорость вставки (символов/сек)
- Наличие структуры кода в буфере

### 2. Верификация оригинальности решения

**Файлы:**
- `server/analyzers/code-originality.py` - анализ через LLM
- `server/analyzers/embedding-matcher.py` - поиск похожих решений

**Методы:**
1. **LLM анализ (qwen3-coder):**
   - Анализ кода на признаки копирования
   - Проверка стиля, комментариев, паттернов
   - Оценка оригинальности 0-100

2. **Векторный поиск (bge-m3):**
   - Генерация эмбеддингов кода
   - Сравнение с базой эталонных решений
   - Поиск похожих решений (cosine similarity)

3. **AST анализ:**
   - Парсинг структуры кода
   - Сравнение структур функций/классов
   - Детектирование идентичных паттернов

### 3. Анализ браузерных расширений

**Файл:** `client/extension-detector.js`

**Методы детектирования:**
1. **DOM-маркеры:**
   - Проверка известных ID элементов (Grammarly, переводчики)
   - Детектирование инжектированных скриптов

2. **Глобальные объекты:**
   - Проверка `window` на наличие объектов от расширений
   - Детектирование переопределенных функций

3. **Content Scripts:**
   - Отслеживание попыток инжекта скриптов
   - Проверка изменений DOM от расширений

**Известные расширения:**
- Grammarly
- Google Translate
- Code completion расширения
- ChatGPT расширения

### 4. Анализ консолей (DevTools)

**Файл:** `client/devtools-detector.js`

**Методы детектирования:**
1. **Размер окна:**
   - DevTools открывается сбоку/снизу → меняет размеры
   - Отслеживание изменений window.innerWidth/Height

2. **Debugger trap:**
   - Периодический вызов `debugger;`
   - Если DevTools открыт → выполнение приостанавливается
   - Замер времени выполнения

3. **Console API:**
   - Перехват console.log/error/warn
   - Детектирование, если функции переопределены

4. **Focus/Blur:**
   - Отслеживание потери фокуса
   - DevTools открытие может вызвать blur

5. **Горячие клавиши:**
   - Перехват F12, Ctrl+Shift+I, Ctrl+Shift+J
   - Детектирование комбинаций для открытия DevTools

6. **DevTools detector library:**
   - Использование библиотек типа `devtools-detect`
   - Проверка console.firebug

## Интеграция с SciBox LLM

### Для анализа оригинальности кода:
```python
# Использование qwen3-coder
originality_score = analyze_code_originality(code, task_description)
```

### Для анализа поведения:
```python
# Использование qwen3-awq
risk_analysis = analyze_proctoring_behavior(events, task_description)
```

### Для поиска похожих решений:
```python
# Использование bge-m3 для эмбеддингов
embedding = generate_embedding(code)
similar_solutions = find_similar(embedding, threshold=0.85)
```

## Оценка риска

Каждое событие имеет веса:
- DevTools открыт: +30
- Большая вставка кода (>100 строк): +40
- Расширение детектировано: +20
- Быстрая вставка кода: +20
- Переключение вкладок: +10

Финальная оценка: 0-100
- 0-30: Низкий риск
- 31-60: Средний риск
- 61-80: Высокий риск
- 81-100: Критический риск

При риск > 50 → отправка в LLM для глубокого анализа.
